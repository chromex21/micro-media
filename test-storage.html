<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Test - Lite Media</title>
    <script src="js/storage-polyfill.js"></script>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Storage System Test</h1>
    <p>This page tests if window.storage is working correctly.</p>
    
    <div class="test-box">
        <h2>1. Check if Storage Exists</h2>
        <div id="storage-check"></div>
    </div>
    
    <div class="test-box">
        <h2>2. Test Set/Get</h2>
        <button onclick="testSet()">Set Test Value</button>
        <button onclick="testGet()">Get Test Value</button>
        <button onclick="testDelete()">Delete Test Value</button>
        <div id="set-get-result"></div>
    </div>
    
    <div class="test-box">
        <h2>3. Test List</h2>
        <button onclick="testList()">List All Keys</button>
        <div id="list-result"></div>
    </div>
    
    <div class="test-box">
        <h2>4. Test Real Data</h2>
        <button onclick="testRealData()">Save Video Metadata</button>
        <button onclick="loadRealData()">Load Video Metadata</button>
        <div id="real-data-result"></div>
    </div>
    
    <div class="test-box">
        <h2>5. Export/Clear</h2>
        <button onclick="exportData()">Export All Data</button>
        <button onclick="clearAll()">Clear All Storage</button>
        <div id="export-result"></div>
    </div>
    
    <script>
        // Check if storage exists
        function checkStorage() {
            const resultDiv = document.getElementById('storage-check');
            
            if (window.storage) {
                resultDiv.innerHTML = `
                    <div class="status success">
                        ‚úÖ window.storage is available!
                    </div>
                    <pre>Methods: ${Object.keys(window.storage).join(', ')}</pre>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå window.storage is NOT available!
                    </div>
                `;
            }
        }
        
        // Test set
        async function testSet() {
            const resultDiv = document.getElementById('set-get-result');
            try {
                const result = await window.storage.set('test-key', 'Hello World!');
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Set successful!</div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Test get
        async function testGet() {
            const resultDiv = document.getElementById('set-get-result');
            try {
                const result = await window.storage.get('test-key');
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Get successful!</div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Test delete
        async function testDelete() {
            const resultDiv = document.getElementById('set-get-result');
            try {
                const result = await window.storage.delete('test-key');
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Delete successful!</div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Test list
        async function testList() {
            const resultDiv = document.getElementById('list-result');
            try {
                const result = await window.storage.list();
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Found ${result.keys.length} keys</div>
                    <pre>${JSON.stringify(result.keys, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Test real data
        async function testRealData() {
            const resultDiv = document.getElementById('real-data-result');
            try {
                const videos = [
                    { file: 'video1.mp4', title: 'My First Video', desc: 'Description here' },
                    { file: 'video2.mp4', title: 'Second Video', desc: 'Another one' }
                ];
                
                const result = await window.storage.set('media-videos', JSON.stringify(videos));
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Saved 2 videos!</div>
                    <pre>${JSON.stringify(videos, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Load real data
        async function loadRealData() {
            const resultDiv = document.getElementById('real-data-result');
            try {
                const result = await window.storage.get('media-videos');
                const videos = JSON.parse(result.value);
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Loaded ${videos.length} videos!</div>
                    <pre>${JSON.stringify(videos, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Export all
        function exportData() {
            const resultDiv = document.getElementById('export-result');
            try {
                const data = window.storage.export();
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Exported ${Object.keys(data).length} items</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
        
        // Clear all
        function clearAll() {
            if (confirm('Clear ALL storage? This cannot be undone!')) {
                localStorage.clear();
                document.getElementById('export-result').innerHTML = `
                    <div class="status success">‚úÖ All storage cleared!</div>
                `;
            }
        }
        
        // Run check on load
        checkStorage();
    </script>
</body>
</html>
